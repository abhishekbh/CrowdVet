<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="/kiva_style.css" rel="stylesheet" type="text/css">
        <meta name="description" content="">
        <meta name="author" content="">
        <script src="//code.jquery.com/jquery-1.9.1.js"></script>
        <script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
        <link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
        <title>Thanks for reviewing!</title>
    </head>

    <style>
        h1{
            text-align: center;
            margin: 5;
            color: LimeGreen;
        }
        h2, h4{
            text-align: center;
            margin: 5;
            color: green;
        }
    </style>

    <body>
        <h2>Thanks for reviewing! Just one more step...</h2>

                <p><div id="data" >
			<a href="https://www.reddit.com/r/kivacrowdvetting" target=_blank>Please join the conversation at this Reddit page</a>
		</div></p>
                <br></br>

		<h4 style="text-align:center">All Results</h4>
                <p><div id="completed-table" ><table class='table table-striped' style="margin: 0em 1em"></table></div></p>            
    </body>

    <script>
        var checkboxes = [];
        var org_id = "<%= org_id %>";

        var load_page = function() {
            load_completed_review();
            load_org_info();
            load_questions();
            press_submit();
        }

       //would like to refactor later
        var load_completed_review = function() {
            $.getJSON('/review/completed/load/' + org_id, function(reviews) {
                $('#completed-table table').append("<tr>" + 
                    "<th>" + "Clear Business Model" + "</th>" +
                    "<th>" + "Clear Social Impact" + "</th>" +
                    "<th>" + "Loan Well Structured" + "</th>" +
                    "<th>" + "Well Positioned to Repay the Loan" + "</th>" +
                    "<th>" + "Well Positioned to Communicate and Market Self" + "</th>" +
                    "<th>" + "Recommended Rating" + "</th>" +
                    "</tr>");
                 $.each(reviews, function(index, review) {
                    $('#completed-table table').append("<tr>" + 
                        "<td>" + review["clear_business_model"] + "</td>" +
                        "<td>" + review["clear_social_impact"] + "</td>" +
                        "<td>" + review["loan_well_structured"] + "</td>" +
                        "<td>" + review["well_positioned_to_repay"] + "</td>" +
                        "<td>" + review["well_positioned_to_communicate"] + "</td>" +
                        "<td>" + review["recommend_rating"] + "</td>" +
                        "</tr>"
                        );
                }); 
            });
        }

        var load_questions = function() {
            $.getJSON('/get_questions/' + org_id, function(questions) {
                $.each(questions, function(index, question) {
                    $('<div class="checkbox">' + '<label>' + '<input type="checkbox" name="box[' + question['_id'] + ']">' + question['question_text'] + '</label>' + '</div>').insertBefore('#question-submit');
                    checkboxes = $("input[type='checkbox']"); 
                    checkboxes.click(function() {
                        if (checkboxes.filter(":checked").length > 3)
                            $(this).removeAttr("checked");
                    });
                }); 
            });
        }

        var press_submit = function() {
            $('form').submit(function() {
                if (checkboxes.filter(":checked").length != 3) {
                alert("You must select 3 questions");
                return false;
            }
            return true;
            });
        }

        $( document ).ready(function() {
            load_page();
        });

    </script>
</html>
